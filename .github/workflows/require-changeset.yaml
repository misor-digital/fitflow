name: Require Changeset

on:
  pull_request:
    branches: [main, main-test]

jobs:
  check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Enforce changeset (unless skipped)
        run: |
          LABELS=$(jq -r '.pull_request.labels[].name' "$GITHUB_EVENT_PATH")
          echo "PR labels: $LABELS"

          if echo "$LABELS" | grep -q "^skip-release$"; then
            echo "ğŸŸ¡ skip-release label present, skipping changeset check"
            exit 0
          fi
          
          if ls .changeset/*.md | grep -v README.md >/dev/null 2>&1; then
            echo "âœ… Changeset found"
            exit 0
          fi

          echo "âŒ No changeset found."
          echo "Either add a changeset or apply the 'skip-release' label."
          exit 1
